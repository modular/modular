load("//bazel:api.bzl", "lit_tests")

lit_tests(
    name = "test",
    srcs = glob(["**/*.mojo"]),
    # TODO(SDLC-2481): add nvshmem libs using cc_library for distribution
    # in python wheels, and remove this env var for bazel tests.
    env = {
        "LD_LIBRARY_PATH": "../+http_archive+libnvshmem/lib/",
    },
    exec_properties = {
        "test.resources:gpu-memory": "4",
    },
    gpu_constraints = select({
        "//:h100_gpu": ["//:has_multi_gpu"],
        "//:b200_gpu": ["//:has_multi_gpu"],
        "//conditions:default": ["@platforms//:incompatible"],
    }),
    mojo_deps = [
        "@mojo//:layout",
        "@mojo//:shmem",
        "@mojo//:stdlib",
    ],
    tags = [
        "gpu",
    ],
    tools = [
        "//KGEN/tools/mojo",
    ],
)
